----------------------------------------------------------------------------------
# Running MITS Altair 8K Basic on the Altair101a

It was written in Intel 8080 assembler language.
There was also a binary file for download.
After a few updates to Altair101a.ino, the binary ran.

Deramp.com [Basic](https://deramp.com/downloads/mfe_archive/010-S100%20Computers%20and%20Boards/00-MITS/40-Software/BASIC/)
(downloads/mfe_archive/010-S100 Computers and Boards/00-MITS/40-Software/BASIC).

Download from the directory [Altair BASIC 5.0/](https://deramp.com/downloads/mfe_archive/010-S100%20Computers%20and%20Boards/00-MITS/40-Software/BASIC/Altair%20BASIC%205.0/).

--------------------------------------------------------------------------------
### First Page
````
basIC.LST                5-Sep-78 14:14:39                              Page  1





            ; SYSTEM INTERFACE 

            ;file   "OK Basic"

          BASIC:                       ;FULL RESTART INITIALIZATION
          SYSINITJ:
0000 C30000  JMP    INITIALZ
          REENTERBASIC:                ;REENTER AFTER PAUSE
0003 C30000  JMP    cmndrstr


            ;Monitor Routines

0006 0406 co equ    406h            ;c -> screen
0006 0409 cinb      equ   409h      ;keyboard -> ac, carry set if any
0006 0538 dclr      equ   538h      :clear screen
0006 04F4 xco equ   4f4h  :c -> printer (blocking)

            NON-BLOCKING INPUT
              CHAR IN AC IF NOT ZERO
          ;   ZERO SET IF NONE

          SYSKEYIN:
0006 C5      push   b
0007 D5      push   d
0008 E5      push   h
0009 CD0904  call   cinb  ;get char
000C D20000  jnc    syskeynone
000F FE00    cpi    0
0011 CA0000  jz     clearscreen
0014 FE1F    cpi    lfh   ;us to break to fourteen
0016 CA0000  jz     gomonitor
          syskeyinret:
0019 El      pop
001A D1      pop
0018 Cl      pop
001C C9      ret
          syskeynone:
001D 97      sub    a     ;set zero
001E C31900  jmp    syskeyinret
          clearscreen:
0021 CD3805  call   dclr  ;clear screen
0024 C31D00  jmp    syskeynone
          gomonitor:
0027 CF      rst    1     ;about using us (Ti-)
0028 00      nop
0029 00      nop

          ; SEND AC TO SCREEN
                    push psw
                    push b
                    push d

basIC.LST                            5-Sep-78   14:14:39                                                    Page     2



002D E5             push      h
002E  4F            mov       c,a
002F C00604         call      co        ;c to  screen
0032 3A0000         lda       p3010     ;print  on  the 3010   if zero
0035 A7             ana       a
0036 CCF404         cz        xco       ;yes print
0039 El             pop       h
003A D1             pop       d
0038 Cl             pop       b
003C Fl             pop       psw
003D C9             RET

                   CHECK FOR BREAK REQUEST 
               ;     SET ZERO TO BREAK

               SYSBREAK:
003E CD0600         call      syskeyin
0041 CA0000         jz        nobreak
0044 97             sub       a
0045 C9             ret
               nobreak:
0046 3E01           mvi       a,1
0048 B7             ora       a
0049 C9             ret
               •
                   DELAY

               SYSWAIT:
004A C9             RET

                   RETURN TO MONITOR

0046 8400      MONITOR        EQU       OB400H
               SYSQUIT:
004B C30084         JMP       MONITOR


          SYSDISPL:
002A F5      push   psw
002B C5      push   b
002C D5      push   d

basIC.LST                     5-Sep-78 14:14:39                                        Page   3

004E 000D   CR  EQU     ODH
004E 000A   LF  EQU     OAH
004E 0007   BEL EQU     07H
004E 0008   BS  EQU     08H
004E 0009   TAB EQU     09H
004E 0009   HT  EQU     09H
004E 0011   DC1 EQU     11H
004E 007F   DEL EQU     7FH
004E 000F   SI  EQU     OFH
004E 0003   ETX EQU     03H
004E 000C   FF  EQU     OCH
004E 001B   ESC EQU     1BH

basICAST                 5-Sep-7814:14:39                                  Page  4

004E0080  KEYSTM EQU80H           ;STATEMENT CODES
004E0080  KEYDAT EQUKEYSTM
004E0081  KEYREM EQUKEYDAT+1
004E0082  KEYLSALEQUKEYREM+1
004E0082  KEYEND EQUKEYLSAL
004E0083  KEYFOR EQUKEYEND+1
004E0084  KEYNEX EQUKEYFOR+1
004E0085  KEYINPTEQUKEYNEX+1
004E0086  KEYDIM EQUKEYINPT+1
004E0087  KEYREA EQUKEYDIM+1
004E0088  KEYLET EQUKEYREA+1
004E0089  KEYGTO EQUKEYLET+1
004E008A  KEYRUN EQUKEYGTO+1
004E008B  KEYIF  EQUKEYRUN+1
004E008C  KEYELS EQUKEYIF+1
004E008D  KEYRES EQUKEYELS+1
004E008E  KEYGSB EQUKEYRES+1
004E008F  KEYRET EQUKEYGSB+1
004E0090  KEYSTOPEQUKEYRET+1
004E0091  KEYON  EQUKEYSTOP+1
004E0092  KEYAUT EQUKEYON+1
004E0093  KEYDEL EQUKEYAUT+1
004E0094  KEYPLT EQUKEYDEL+1
004E0095  KEYWAI EQUKEYPLT+1
004E0096  KEYPRT EQUKEYWAI+1
004E0097  KEYDEF EQUKEYPRT+1
004E0098  KEYCON EQUKEYDEF+1
004E0099  KEYLIS EQUKEYCON+1
004E009A  KEYEDI EQUKEYLIS+1
004E009B  KEYCLR EQUKEYEDI+1
004E009C  KEYCLD EQUKEYCLR+1
004E009D  KEYCSV EQUKEYCLD+1
004E009E  KEYNEW EQUKEYCSV+1
004E009F  KEYSET EQUKEYNEW+1
004E00A0  KEYSUGREQUKEYSET+1
004EOOAO  KEYLSBLEQUKEYSUGR
004EOOAO  KEYTHENEQUKEYSUGR
004E00A1  KEYTO  EQUKEYTHEN+1
004E00A2  KEYSTEPEQUKEYT0+1
004E00A3  KEYLSBHEQUKEYSTEP+1
004E00A3  KEYPRM EQUKEYLSBH
004E00A4  KEYLINEEQUKEYPRM+1
004E00A5  KEYLSAHEQUKEYLINE+1
004E00A5  KEYTAB EQUKEYLSAH
004E00A6  KEYSPC EQUKEYTAB+1
004E00A7  KEYFN  EQUKEYSPC+1
004E00A8  KEYNOT EQUKEYFN+1
004E00A9  KEYOFF EQUKEYNOT+1

004E00AA  KEYOPR EQUKEYOFF+1      ;OPERATOR CODES
004E00AA  KEYADD EQUKEYOPR
004EOOAB  KEYSUB EQUKEYADD+1
004EOOAC  KEYMUL EQUKEYSUB+1
004EGOAD  KEYDIV EQUKEYMUL+1
004EOOAE  KEYMOD EQUKEYDIV+1
004EOOAF  KEYEXPTEQUKEYMOD+1

basIC.LST                 5-Sep-7814:14:39                                  Page  5



004E00B0  KEYAND EQU KEYEXPT+1
004E0081  KEYOR  EQU KEYAND+1
004E0082  KEYMAX EQU KEYOR+1
004E0083  KEYMIN EQU KEYMAX+1

004E00B4  KEYREL EQU KEYMIN+1      ;RELATION CODES
004E0084  KEYGT  EQU KEYREL
004E00B5  KEYEQ  EQU KEYGT+1
004E00B6  KEYLT  EQU KEYEQ+1

004E0087  KEYFCT EQU KEYLT+1       ;FUNCTION CODES
004E0087  KEYSGN EQU KEYFCT
004E0088  KEYINT EQU KEYSGN+1
004E00B9  KEYABS EQU KEYINT+1
004EOOBA  KEYSQR EQU KEYABS+1
004E00B8  KEYRND EQU KEYSQR+1
004EOOBC  KEYLOG EQU KEYRND+1
004FOORD  KEYEXP EQU KEYLOG+1
004E006E  KEYCOS EQU KEYEXP+1
004EOOBF  KEYSIN EQU KEYCOS+1
004E0000  KEYTAN EQU KEYSIN+1
004E00C1  KEYATA EQU KEYTAN+1
004E00C2  KEYUSR EQU KEYATA+1
004E00C3  KEYFRE EQU KEYUSR+1
004E00C4  KEYPORTEQU KEYFRE+1
004E0005  KEYPOS EQU KEYPORT+1
004E0006  KEYMEM EQU KEYPOS+1
004E0007  KEYLEN EQU KEYMEM+1
004E0008  KEYSTR EQU KEYLEN+1
004E00C9  KEYVAL EQU KEYSTR+1
004EOOCA  KEYASC EQU KEYVAL+1
004E0008  KEYCHR EQU KEYASC+1
004E00CC  KEYHEX EQU KEYCHR+1
004EOOCD  KEYHXV EQU KEYHEX+1
004EOOCE  KEYUPR EQU KEYHXV+1
004EOOCF  KEYLFT EQU KEYUPR+1
004EOODO  KEYRIG EQU KEYLFT+1
004E00D1  KEYMID EQU KEYRIG+1
004E00D2  KEYINS EQU KEYMID+1

004E00D3  KEYS   EQU KEYINS+1      ;LAST ENTRY

basIC.LST                 5-Sep-7814:14:39                                  Page  6



          STMTABL:                ;STATEMENT ROUTINES
004E0000      DW    DATSTM
00500000      DW    REMSTM
                                  ;LISTED WITH BLANK AFTER
00520000      DW    ENDSTM
00540000      DW    FORSTM
00560000      DW    NEXSTM
00580000      DW    INPSTM
005A0000      DW    DIMSTM
005C0000      DW    REASTM
005E0000      DW    LETSTM
00600000      DW    GTOSTM
00620000      DW    RUNSTM
00640000      DW    IFSTM
00660000      DW    ELSSTM
00680000      DW    RESSTM
006A0000      DW    GSBSTM
006C0000      DW    RETSTM
006E0000      DW    STPSTM
00700000      DW    ONSTM
00720000      DW    AUTSTM
00740000      DW    DELSTM
00760000      DW    PLTSTM
00780000      DW    WAISTM
007A0000      DW    PRTSTM
007C0000      DW    DEFSTM
007E0000      DW    CONSTM
00800000      DW    LISSTM
00820000      DW    EDISTM
00840000      DW    CLRSTM
00860000      DW    CLDSTM
00880000      DW    CSVSTM
008A0000      DW    NEWSTM
008C0000      DW    SETSTM

basIC.LST                    5-Sep-78 14:14:39                                       Page   7



            OPRTABL:                   ;OPERATORS AND PRECEDENCE
008E 79         DB     79H
008F 0000       DW     ADDOPR
0091 79         DB     79H
0092 0000       DW     SUBOPR
0094 7B         DB     7BH
0095 0000       DW     MULOPR
0097 7B         DB     7BH
0098 0000       DW     DIVOPR
009A 7B         DB     7BH
009B 0000       DW     MODOPR
009D 7F         DB     7FH
009E 0000       DW     EXPOPR
00A0 50         DB     50H
00A1 0000       DW     ANDOPR
00A3 46         DB     46H
00A4 0000       DW     ORNOPR
00A6 76         DB     76H
00A7 0000       DW     MAXOPR
00A9 76         DB     76H
OOAA 0000       DW     MINOPR

basIC.LST                    5-Sep-78 14:14:39                                      Page   8



           FCTTABL:                   ;FUNCTION ROUTINES
00AC 0000      DW      SGNFCT
00AE 0000      DW      INTFCT
0080 0000      DW      ABSFCT
0082 0000      OW      SQRFCT
00B4 0000      DW      RNDFCI
00B6 0000      DW      LOGFCT
0068 0000      DW      EXPFCT
00BA 0000      DW      COSFCT
00BC 0000      DW      SINFCT
00BE 0000      DW      TANFCT
0000 0000      DW      ATNFCT
00C2 0000      DW      ERRAFC
00C4 0000      DW      FREFCT
0006 0000      DW      PORFCT
0008 0000      DW      POSFCT
OOCA 0000      DW      MEMFCT
00CC 0000      DW      IFNFCT
OOCE 0000      DW      STRFCT
OODO 0000      DW      VALFCT
00D2 0000      DW      ASCFCT
00D4 0000      DW      CHRFCT
00D6 0000      DW      HEXFCT
00D8 0000      DW      HXVFCT
OODA 0000      DW      UPRFCT
OODC 0000      DW      LFTFCT
OODE 0000      DW      RIGFCT
00E0 0000      DW      MIDFCT
00E2 0000      DW      INSFCT

basIC.LST                5-Sep-78 14:14:39                              Page  9



          KEYWADDS:              ;POINTERS TO KEYWORD GROUPS 
00E4 000000  DW    KEYWRDO, KEYWRD1, KEYWRD2, KEYWRD3
00E7 000000
OOEA 0000
OOEC 000000  DW    KEYWRD4, KEYWRD5, KEYWRD6, KEYWRD7 
00EF 000000
00F2 0000
00F4 000000  DW    KEYWRD8, KEYWRD9, KEYWRDA, KEYWRDB 
00F7 000000
OOFA 0000
OOFC 000000  DW    KEYWRDC, KEYWRDD, KEYWRDE, KEYWRDF
DOFF 000000
0102 0000
          KEYWORDS:
          KEYWRDO:
0104 94504C  DB    KEYPLT,   "PLO", 'T+128
0107 4FD4
Wing 965052  DB    KFYPRT,   "TRW, 'T+178
010C 494ED4
010F A35052  DB    KEYPRM,   "PROMP", 'T+128
0112 4F4D50
0115 D4
0116 C4504F  DB    KEYPORT,  "POR", 'T+128
0119 52D4
011B 45504F  DB    KEYPOS-80H, "PO", 'S+128
011E D3
          KEYWRD1:
011F 924155  DB    KEYAUT,   "AUT", '0+128
0122 54CF
0124 80414E  DB    KEYAND,   "AN", 'D+128
0127 C4
0128 B94142  DB    KEYABS,   "AB", 'S+128
012B D3
012C C14154  DB    KEYATA,   "AT", 'N+128
012F CE
0130 4A4153  DB    KEYASC-80H, "AS", 'C+128
0133 C3
          KEYWRD2:
0134 815245  DB    KEYREM,   "RE", 'M+128
0137 CD
0138 875245  DB    KEYREA,   "REA", 'D+128
013B 41C4
013D 8A5255  DB    KEYRUN,   "RU", 'N+128
0140 CE
0141 8D5245  DB    KEYRES,   "RESTOR", 'E+128
0144 53544F
0147 52C5
0149 8F5245  DB    KEYRET,   "RETUR", 'N+128
014C 545552
014F CE
0150 BB524E  DB    KEYRND,   "RN", 'D+128
0153 C4
0154 505249  DB    KEYRIG-80H, "RIGHT", '$+128
0157 474854
015A A4
          KEYWRD3:

basIC.LST                    5-Sep-78 14:14:39                                      Page  10



015B 905354    DB      KEYSTOP,   "STO", 'P+128
015E 4F00
0160 98434F    DB      KEYCON,    "CON", 'T+128
0163 4E04
0165 98434C    DB      KEYCLR,    "CLEA", 'R+128
0168 454102
0168 9D5341    DB      KEYCSV,    "SAV", 'E+128
016E 56C5
0170 9F5345    DB      KEYSET,    "SE", '1+128
0173 D4
0174 A25354    DB      KEYSTEP,   "STE", 'P+128
0177 4500
0179 A65350    DB      KEYSPC,    "SP", 'C+128
017C C3
017D 875347    DB      KEYSGN,    "SG", 'N+128
0180 CE
0181 BA5351    DB      KEYSQR,    "SQ", 'R+128
0184 D2
0185 BE434F    DB      KEYCOS,    "CO", 'S+128
0188 D3
0189 BF5349    DB      KEYSIN,    "SI", 'N+128
018C CE
018D C85354    DB      KEYSTR,    "STR", '$+128
0190 52A4
0192 4B4348    DB      KEYCHR-80H,"CHR", '$+128
0195 52A4
           KEYWRD4:
0197 804441    DB      KEYDAT,    "DAT", 'A+128
019A 54C1
019C 864449    DB      KEYDIM,    "DI", 'M+128
019F CD
01A0 934445    DB      KEYDEL,    "DELET", 'E+128
01A3 4C4554
01A6 C5
01A7 974445    DB      KEYDEF,    "DE", 'F+128
01AA C6
O1AB A05448    DB      KEYTHEN,   "THE", 'N+128
01AE 45CE
0180 A154CF    DB      KEYTO,     "T", '0+128
0183 A55441    DB      KEYTAB,    "TA", 'B+128
0186 C2
0187 405441    DB      KEYTAN-80H,"TA", 'N+128
01BA CE
           KEYWRD5:
01BB 82454E    DB      KEYEND,    "EN", 'D+128
018E C4
01BF 8C454C    DB      KEYELS,    "ELS", 'E+128
01C2 53C5
01C4 9A4544    DB      KEYEDI,    "EDI", 'T+128
01C7 4904
01C9 BD4558    DB      KEYEXP,    "EX", `P+128
01CC DO
01CD C25553    DB      KEYUSR,    "US", 'R+128
0100 D2
0101 4E5550    DB      KEYUPR-80H,"UPPER", '$+128
0104 504552

basIC.LST              5-Sep-78 14:14:39                          Page 11



0107 A4
         KEYWRD6:
0108 83464F DB    KEYFOR,  "FO", 'R+128
01DB D2
O1DC A746CE DB    KEYFN,   "F", 'N+128
O1DF C34652 DB    KEYFRE,  "FR", 'E+128
01E2 C5
01E3 495641 DB    KEYVAL-80H, "VA", 'L+128
01E6 CC
         KEYWRD7:
01E7 89474F DB    KEYGTO,  "GOT", '0+128
01EA 54CF
01EC 8E474F DB    KEYGSB,  "GOSU", 'B+128
01EF 5355C2
01F2 155741 DB    KEYWAI-80H, "WAI", 'T+128
01F5 4904
         KEYWRD8:
01F7 CC4845 DB    KFYHFX,  "HFX", 1+12A
01FA 58A4
01FC 404845 DB    KEYHXV-80H, "HEX", 'V+128
01FF 5806
         KEYWRD9:
0201 85494E DB    KEYINPT, "INPU", '1+128
0204 505504
0207 8849C6 DB    KEYIF,   "I", 'F+128
020A 88494E DB    KEYINT,  "IN", 'T+128
020D D4
020E 52494E DB    KEYINS-80H, "INST", 'R+128
0211 535402
         KEYWRDA:
0214 2CAA   DB    KEYMUL-80H, '*+128
         KEYWRD6:
0216 2AAB   DB    KEYADD-80H, '++128
         KEYWRDC:
0218 884C45 DB    KEYLET,  "LE", '1+128
021B D4
021C 994C49 DB    KEYLIS,  "LIS", 'T+128
021F 5304
0221 9C4C4F DB    KEYCLD,  "LOA", 'D+128
0224 41C4
0226 A44C49 DB    KEYLINE, "LIN", 'E+128
0229 4EC5
0228 B6BC   DB    KEYLT,   '(+128
022D BC4C4F DB    KEYLOG,  "LO", 'G+128
0230 C7
0231 C74C45 DB    KEYLEN,  "LE", 'N+128
0234 CE
0235 4F4C45 DB    KEYLFT-80H, "LEFT", '$+128
0238 4654A4
         KEYWRDD:
023B ABAD   DB    KEYSUB,  '-+128
023D AE4D4F DB    KEYMOD,  "MO", 'D+128
0240 C4
0241 B24D41 DB    KEYMAX,  "MA", 'X+128
0244 08
0245 B34D49 DB    KEYMIN,  "MI", 'N+128

basIC.LST                   5-Sep-78 14:14:39                                     Page  12



0248 CE
0249 B5BD      DB     KEYEQ,     ,.+128
024B C64D45    DB     KEYMEM,    "ME", 'M+128
024E CD
0241 514049    DB     KEYMID-80H,"MID", '$+128
0252 44A4
           KEYWRDE:
0254 844E45    DB     KEYNEX,    "NEX", 'T+128
0257 58D4
0259 9E4E45    DB     KEYNEW,    "NE", 'W+128
025C D7
025D A84E4F    DB     KEYNOT,    "NO", 'T+128
0260 D4
0261 AFDE      DB     KEYEXPT,   't+128
0263 34BE      DB     KEYGT-80H, '>+128
           KEYWRDF:
0265 96BF      DB     KEYPRT,    '?+128
0267 914FCE    DB     KEYON;     "0", 'N+128
026A A94F46    DB     KEYOFF,    "OF", 'F+128
026D C6
026E ADAF      DB     KEYDIV,    '/+128
0270 3141D2    DB     KEYOR-80H, "0", 'R+128

basIC.LST                   5-Sep-78 14:14:39                                     Page  13



           ERRN:                             ;ERROR CODES
           ERRNCN:
0273 434F4E    DB     "CONTINUE",0           ;CONTINUE ERROR
0276 54494E
0279 554500
           ERRNSL:
027C 444556    DB     "DEVICE",0             ;SAVE/LOAD DEVICE ERROR
027F 494345
0282 00
           ERRNDD:
0283 44494D    DB     "DIMENSION",0          ;DOUBLE DIMENSION
0286 454E53
0289 494F4E
028C 00
           ERRNID:
028D 444952    DB     "DIRECT",0             ;ILLEGAL DIRECT
0290 454354
0293 00
           ERRNDO:
0294 444956    DB     "DIVIDE BY 0",0        ;DIVISION BY ZERO
0297 494445
029A 204259
029D 203000
           ERRNFC:
02A0 46554E    DB     "FUNCTION CALL",0      ;FUNCTION CALL
02A3 435449
02A6 4F4E20
02A9 43414C
02AC 4C00
           ERRNLS:
02AE 4C4F4E    DB     "LONG STRING",O        ;LONG STRING
0261 472053 
0284 545249 
0267 4E4700
           ERRNOM:
02BA 404540    DB     "MEMORY SPACE",0       ;OUT OF MEMORY
02BD 4F5259 
02C0 205350 
02C3 414345 
02C6 00
           ERRNNF:
02C7 4E4558    DB     "NEXT W/0 FOR",0       ;NEXT WITHOUT FOR
02CA 542057 
02CD 2F4F20 
0200 464F52 
0203 00
           ERRNOD:
0204 4F5554    DB     "OUT OF DATA",0        ;OUT OF DATA
0207 204F46 
02DA 204441 
02DD 544100
           ERRNOV:
02E0 4F5645    DB     "OVERFLOW",0           ;OVERFLOW
02E3 52464C 
02E6 4F5700
           ERRNRG:

basIC.LST               5-Sep-78 14:14:39                              Page 14



02E9 524554  DB    "RETN W/0 GOSUB",0  ;RETURN WITHOUT GOSUB
02EC 4E2057 
02EF 2F4F20 
02F2 474F53 
02F5 554200
          ERRNOS:
02F8 535452  DB    "STRING SPACE",0    ;OUT OF STRING SPACE
02FB 494E47 
02FE 205350 
0301 414345 
0304 00
          ERRNST:
0305 535452  DB    "STRING TEMPS",0    ;STRING TEMPORARIES
0308 494E47 
030B 205445 
030E 4D5053 
0311 00
          ERRNBS:
0312 535542  DB    "SUBSCRIPT",0       ;BAD SUBSCRIPT
0315 534352 
0318 495054
031B 00
          ERRNSN:
031C 53594E  DB    "SYNTAX",0          ;SYNTAX ERROR
031F 544158
0322 00
          ERRNTM:
0323 545950  DB    "TYPE",0            ;TYPE MISMATCH
0326 4500
          ERRNUF:
0328 554E44  DB    "UNDFND FUNCTION",0 ;UNDEFINED FUNCTION
032B 464E44 
032E 204655 
0331 4E4354 
0334 494F4E 
0337 00
          ERRNUS:
0338 554E44  DB    "UNDFND LINE",0     ;UNDEFINED STATEMENT
0338 464E44 
033E 204C49 
0341 4E4500
          ERRNUV:
0344 554E44  DB    "UNDFND VARIABLE",0 ;UNDEFINED VARIABLE
0347 464E44 
034A 205641 
034D 524941 
0350 424C45 
0353 00
          ERRNFI:
0354 46696C  DB    "File not Saved",0  ;unknown file name
0357 65206E 
035A 6F7420 
035D 536176 
0360 656400

basIC.LST                     5-Sep-78 14:14:39                                        Page 15




            ; INTERPRETER VARIABLES

                        VARIABLES MARKED WITH SAME CHARACTER IN COLUMN 71 
                           ARE  FIXED IN THAT ORDER.



0363 01     p3010:      db      1              ;0 to print on 3010
0364 00     REAINPFL:   DB      0              ;READ/INPUT FLAG
0365 00     PRINTFLG:   DB      0              ;PRINT/NO PRINT FLAG
0366 01     TRACEFLG:   DB      1 _            ;TRACE/NO TRACE FLAG
0367 00     SCANPFLG:   DB      0              ;SCAN/NOSCAN PARENTHESIS FLAG
0368 01     SCANPFLE:   DB      1              ;ARRAY NAME FOR ERASE
0369 OOAB   SCANPFLD    EQU     KEYS-'( ;NO ARRAY ELEMENTS WANTED
0369 00     MATSCCNT:   DB      0              ;SUBSCRIPT COUNT
036A 00     MATDMFLG:   DB      0              ;SCANNING FOR VAR/DIMENSION  V
036R 00     TYPEFLG:    DB      0              ;TYPE FLAG -                 V
036C 0002   TYPEINTG    EQU     2              ;TYPE OF INTEGER
036C 0003   TYPESTRG    EQU     3              ;TYPE OF STRING
036C 0004   TYPESING    EQU     4              ;TYPE OF SINGLE FLOATING POINT
036C 0008   TYPEDUBL    EQU     8              ;TYPE OF DOUBLE FLOATING POINT
036C 0020   TYPEDEF     EQU     080H/4         ;MARKING BIT FOR USER-FUNCTION


036C 00     STRGTMPL:   DB      0              ;TEMP STRING DESCRPTR, LEN   S
036D 0000   STRGTMPA:   DW      0              ;TEMP STRING DESCRPTR, ADDR  S
036F 0000   SCANPTR1:   DW      0              ;SCAN POINTER
0371 0000   SCANPTR2:   DW      0              ;SCAN POINTER
0373 FFFF   CURLINE:    DW      -1             ;CURRENT LINE NUMBER
0375 0000   CURLINES:   DW      0              ;SAVED CURRENT LINE NUMBER
0377 0000   PROGCNTR:   DW      ENDINTRP+12    ;CURRENT PROGRAM LOCATION
0379 0377   VARINDEX    EQU     PROGCNTR       ;INDEX VARIABLE OF FOR
0379 0000   PROGCNTS:   DW      0              ;SAVED CURRENT PROGRAMLOCATION
037B 0000   CURLDATA:   DW      0              ;CURRENT DATA LINE NUMBER
037D 0000   CURDATAP:   DW      ENDINTRP       ;CURRENT DATA POINTER
037F 0000   INPTBUFR:   DW      INITSTSP       ;INPUT BUFFER ADDRESS
0381 0064   PREDREL     EQU     064H           ;PRECEDENCE OF RELATION
0381 0070   PREDNUM     EQU     070H           ;LOWER BNDRY OF NUM OP PREC.
0381 005A   PREDNOT     EQU     05AH           ;PRECEDENCE OF NOT OPERATOR
0381 007D   PREDUMIN    EQU     07DH           ;PRECEDENCE OF UNARY MINUS
0381 009D   LINESYZE    EQU     79+78          ;DEFAULT LINESYZE
0381 000E   ITEMSIZE    EQU     14             ;DEFAULT WIDTH OF PRINT ITEM

basIC.LST                        5-Sep-78 14:14:39                                              Page 16




             ; MEMORY ALLOCATION POINTERS




0381 8000    LIMLOWER     EQU      08000H
0381 AFOO    LIMUPPER     EQU      OAFOOH

             ; MEMORY LAYOUT

             ; ENCODE BUFFER
             ; PROGRAM
             ; VARIABLES 
             ; ARRAYS
             ; FREE SPACE / STACK (INCLUDING BUFFERS)
             ; FREE STRING SPACE
                STRINGS
             ; STRING TEMPORARIES
             ; FREE STRING TEMPORARIES

0381 0000    PROGBASE:    DW       ENDINTRP+13      ;BASE OF PROGRAM SPACE
0383 0000    VARTABLE:    DW       ENDINTRP+15      ;BASE OF VARIABLE TABLE
0385 0000    MATTABLE:    DW       ENDINTRP+15      ;BASE OF ARRAY TABLE
0387 0000    FREELIMT:    DW       ENDINTRP+15      ;LOWER LIMIT OF FREE SPACE
0389 0000    STCKBASE:    DW       INITSTCK         ;BASE OF STACK
0388 0000    STRGFREE:    DW       INITSTCK+10      ;FIRST FREE STRING SPACE
038D 0000    STRGBASE:    DW       INITSTCK+10      ;BASE OF STRING SPACE
038F 0000    STRGTMPP:    DW       INITSTCK+11      ;STRING TEMPORARY ALLOC PTR
0391 0000    STRGTLIM:    DW       INITSTCK+10+2*3  ;STRING TEMPORARY LIMIT


0393 0000    ACCUMLTR:    DB       0,0      ;ACCUMULATOR                       A
0395 00      FLACCMSB:    DB       0        ;SIGN-BIT/HIGH-ORDER MANTISSA      A
0396 00      FLACCEXP:    DB       0        ;EXPONENT                          A
0397 00      FLACCSSV:    DB       0        ;SAVED SIGN                        A

0398 01      NULLCNT:     DB       1        ;# OF NULLS TO INSERT AFTER (CR)
0399 01      CURSPOS:     DB       1        ;CHARACTER CURSOR POSITION         C
039A 63      CURSLIM:     DB       -LINESYZE        ;OUTPUT CURSOR LIMIT        C

039B 00      FLSCRO:      DB       0        ;FLOATING POINT SCRATCH AREA
039C 01      FLSCR1:      DB       1
0390 02      FLSCR2:      DB       2
039E 03      FLSCR3:      DB       3

039F 039B    INOTINS      EQU      FLSCRO   ;INPUT/OUTPUT INSTRUCTIONS
039F 00DB    OPCINP       EQU      ODBH     ;INPUT INSTRUCTION
039F 0003    OPCOUT       EQU      OD3H     ;OUTPUT INSTRUCTION
039F 00C9    OPCRET       EQU      OC9H     ;RETURN INSTRUCTION

039F 52C74F RNDFCTSD:     DB       052h, Oc7h,  04fh, 080h   ;RANDOM SEED
03A2 80

basIC.LST              5-Sep-78 14:14:39                          Page 17






           GENERAL USE SUBROUTINES



           SCAN ONE CHARACTER AND CLASSIFY

         SCANNXTV:
03A3 7E     MOV   A,M   ;SCAN CURRENT BYTE,
03A4 E3     XTHL
03A5 BE     CMP   M     ;VERIFY MATCH,
03A6 23     INX
03A7 E3     XTHL
03A8 C20000 JNZ   ERRASN ;SQUAWK ABOUT SYNTAX ERROR
         SCANNXT:
03AR 23     INX   H     ;SCAN FOR NFXT NON-R1ANK CHAR
03AC 7E     MOV   A,M   ;C=NUMERIC CHARACTER
03AD FE3A   CPI   ":"   ;Z=END OF STATEMENT
03AF DO     RNC
03B0 FE20   CPI
03B2 CAABO3 JZ    SCANNXT
03B5 FE30   CPI   "0"
03B7 3F     CMC
03B8 3C     INR   A
03B9 3D     DCR   A
03BA C9     RET

basIC.LST                   5-Sep-78 14:14:39                                   Page 18







           ; TEST FOR ALPHABETIC CHARACTER

           ALPHACHK:
03BB 7E        MOV    A,M     ;TEST FOR ALPHABETIC CHARACTER
           ALPHACHA:
03BC FE7B      CPI    'z+1    ;LOWER CASE
03BE DO        RNC
03BF FE61      CPI    "a"     ;LOWER CASE
03C1 020000    JNC    ALPHACHL
03C4 FE5B      CPI    'Z+1    ;C=ALPHABETIC
03C6 DO        RNC
03C7 FE41      CPI            ;UPPER CASE
03C9 3F        CMC
03CA C9        RET
           ALPHACHL:
03CB C6E0      ADI    'A-'a   ;CONVERT LOWER TO UPPER
03CD C9        RET


           ; MATCH CHARACTER OF BUFFER AGAINST CHARACTER IN A

           CHARMTCH:
03CE AE        XRA    M       ;MAKE MATCH TEST
03CF C8        RZ             ;Z=SUCCESS]
0300 FE20      CPI    'a-'A   ;LOWER CASE - UPPER CASE
0302 CO        RNZ            ;NOT LOWER-UPPER DIFFERENCE
0303 CDBB03    CALL   ALPHACHK       ;ALPHABETIC?
0306 9F        SBB    A
0307 3C        INR    A       ;Z=C,S=0
0308 C9        RET


           ; CHECK TYPE OF EXPRESSION             LEN CHAR
                       RETURNS: S => INTEGER       2    %
                                Z => STRING        3    $
                               PO => SINGLE        4    @
                               NC => DOUBLE        8    #

           TYPECHK:
0309 3A6B03    LDA    TYPEfLG
           TYPECHKA:
03DC FE05      CPI    TYPESING+1
03DE 3D        DCR    A
03DF 3D        DCR    A
03E0 3D        DCR    A
03E1 B7        ORA    A
03E2 37        STC
03E3 C9        RET

basIC.LST             5-Sep-78 14:14:39                          Page 19








         ; SCAN A PAIR OF LINE NUMBER PARAMETERS


         SCANLPRZ:
03E4 010000 LXI   B4O   ;DEFAULT SECOND IS FIRST
         SCANLPRM:
03E7 C40000 CNZ   SCANLINN    ;DEFAULT FIRST IS IN DE
03EA F5     PUSH  PSW
03EB 78     MOV   A,B
03EC B1     ORA   C     ;ZERO DEFAULT IS FIRST PARAMETER
03ED C20000 JNZ   SCANLPR1
03F0 42     MOV   B,D
03F1 4B     MOV   C,E
         SCANLPR1:
03F2 F1     POP   PSW
03F3 EB     XCHG
03F4 E3     XTHL        :PUT FIRST ONTO STACK
03F5 E5     PUSH  H
03F6 EB     XCHG
03F7 50     MOV   D,B
03F8 59     MOV   E,C
03F9 C8     RZ
03FA FEAD   CPI   KEYDIV ;SEPARATOR MUST BE "/",
03FC CA0000 JZ    SCANLPR2
03FF CDA303 CALL  SCANNXTV    ;bscan (val)
0402 2C     DB    IT ft ; OR ","
0403 2B     DCX
         SCANLPR2:
0404 11FFFF LXI   D,OFFFFH    ;EMPTY SECOND OPERAND = END
0407 CDABO3 CALL  SCANNXT ;bscan ,
040A C8     RZ



         ; SCAN A LINE NUMBER


         SCANLINN:
040B 2B     DCX   H     ;SCAN LINE # IN COMMAND/STATEMENT 
         SCANLINR:
040C 110000 LXI   D,0   ;DEFAULT LINE IS 0, INITIALIZE 
         SCANLINL:
040F CDABO3 CALL  SCANNXT ;bscan ,
0412 DO     RNC
0413 E5     PUSH  H
0414 F5     PUSH  PSW
0415 219819 LXI   H2OFFFFH/10-1
0418 CD0000 CALL  CMHLLTDE
041B DA0000 JC    ERRASN
041E 62     MOV   H,D
041F 6B     MOV   L,E   ;HL=10*DE
0420 19     DAD
0421 29     DAD
0422 19     DAD
0423 29     DAD
0424 F1     POP   PSW
0425 D630   SUI   "0"   ;GET VALUE OF NEXT DIGIT

basIC.LST              5-Sep-78 14:14:39                          Page 20



0427 5F     MOV   E,A
0428 1600   MVI   D,000H
042A 19     DAD   D     ;AND ADD IT ON
042B EB     XCHG
042C El     POP   H
042D C30F04 JMP   SCANLINL

basIC.LST                     5-Sep-78 14:14:39                                         Page 21





            ; SEARCH FOR A GIVEN LINE NUMBER

            LINESRCH:
0430 2A8103     LHLD    PROGBASE        ;LOOK FOR LINE NUMBER IN DE
            LINESRCL:
0433 E5         PUSH    H       ;C=LINE FOUND
0434 CD0000     CALL    LINELINK        ;BC=LINE LOCATION, IF FOUND
0437 CA0000     JZ      POPHLRET        ;=NEXT LINE, IF NOT FOUND
043A C5         PUSH            ;ADDRESS OF NEXT LINE
043B 7E         MOV     A,M     ;GET NUMBER OF CURRENT LINE
043C 23         INX     H
043D 66         MOV     H,M     ;(from HL,MA)
043E 6F         MOV     L,A
043F CD0000     CALL    CMHLLTDE
0442 El         POP     H       ;HL=NEXT LINE
0443 Cl         POP     B
0444 3F         CMC
0445 C8         RZ
0446 D23304     JNC     LINESRCL
0449 60         MOV     H,B
044A 69         MOV     L,C
044B 3F         CMC
044C C9         RET


            ;  LINK TO NEXT LINE

            LINELINK:
044D E5         PUSH    H       ;FIND ADDRESS OF NEXT LINE
044E 4E         MOV     C,M     ;Z=END OF PROGRAM
044F 23         INX     H
0450 46         MOV     B,M
0451 23         INX     H
0452 E3         XTHL
0453 09         DAD     B       ;ADD LENGTH TO ADDRESS
0454 E3         XTHL
0455 78         MOV     A,B
0456 Bl         ORA     C
0457 Cl         POP
0458 C9         RET

basIC.LST                     5-Sep-78 14:14:39                                         Page 22





            ;  INSERT/REPLACE LINE OF PROGRAM

            LINEINS:
0459 D5         PUSH    D       ;DE=LINE NUMBER
045A D40000     CNC     KEYSCAN ;C=ALREADY KEY-SCANNED
045D CDABO3     CALL    SCANNXT ;bscan ,        ;NC-MUST BE KEY-SCANNED
0460 D1         POP     D
0461 E5         PUSH    H       ;HL=TEXT TO INSERT
0462 D5         PUSH    D
0463 C5         PUSH    B       ;BC=LENGTH OF TEXT
0464 F5         PUSH    PSW     ;Z=DELETE, NO REPLACE
0465 CD3004     CALL    LINESRCH        ;LOOK FOR LINE
0468 C5         PUSH    B       ;SAVE LOCATION
0469 DC0000     CC      LINEDEL ;DELETE IF PRESENT
046C D1         POP     D
046D Fl         POP     PSW
046E CA0000     JZ      POPHL3RT        ;EXIT IF NOTHING MORE
0471 2A8703     LHLD    FREELIMT        ;PULL APART FOR NEW LINE
0474 E3         XTHL
0475 Cl         POP     B
0476 E5         PUSH    H
0477 09         DAD     B
0478 CD0000     CALL    COPYCHK
047B EB         XCHG
047C Cl         POP     B
047D 71         MOV     M,C     ;BEGINNING OF NEW LINE
047E 23         INX     H
047F 70         MOV     M,B
0480 23         INX     H
0481 D1         POP     D
0482 73         MOV     M,E     ;INSERT LINE NUMBER
0483 23         INX     H
0484 72         MOV     M,D
0485 23         INX     H
0486 EB         XCHG
0487 El         POP     H       ;RECOVER TEXT POINTER
            LINEINSL:
0488 7E         MOV     A,M     ;INSERT TEXT OF NEW LINE
0489 12         STAX    D
048A 23         INX     H
048B 13         INX     D
048C B7         ORA     A
048D C28804     JNZ     LINEINSL
0490 C30000     JMP     LINEDELU

basIC.LST                5-Sep-78 14:14:39                              Page 23





          ; DELETE TEXT FROM PROGRAM

          LINEDEL:
0493EB       XCHG         ;BC=BEGINNING OF TEXT TO REMOVE
049479       MOV   A,C
049593       SUB   E      ;COMPUTE NEGATIVE OF
04966F       MOV   L,A    ;NUMBER OF BYTES DELETED
049778       MOV   A,B
04989A       SBB
049967       MOV   H,A
049AE5       PUSH  H
04982A8703   LHLD  FREELIMT      ;HL=BEGINNING OF TEXT SURVIVING
          LINEDELL:
049E1A       LDAX  D
049F02       STAX  B
04A003       INX
04A113       INX
04A2CD0000   CALL  CMHLLTDE
04A5D29E04   JNC   LINEDELL
04A8C1       POP
          LINEDELU:
04A92A8703   LHLD  FREELIMT      ;UPDATE DATA POINTERS
04AC09       DAD   B      ;BC=INCREMENT
04AD228703   SHLD  FREELIMT
04802A8503   LHLD  MATTABLE
048309       DAD
0484228503   SHLD  MATTABLE
04872A8303   LHLD  VARTABLE
04BA09       DAD
0488228303   SHLD  VARTABLE
048EC30000   JMP   CLEARPCN


          ; MAKE SIXTEEN BIT COMPARISON

          CMHLLTDE:
04C17C       MOV   A,H    ;COMPARE DE VS HL
04C292       SUB   D      ;C=HL<DE
04C3CO       RNZ
04C47D       MOV   A,L
04C593       SUB
04C6C9       RET

basIC.LST              5-Sep-78 14:14:39                           Page 24





          ; MOVE LONG TO HIGHER ADDRESS

          COPYCHK: 
04C7 CD0000  CALL  SPACECHK
          COPYTEXT:
04CA C5      PUSH  B     ;COPY SECTION DE-BC TO AREA
04CB E3      XTHL        ;ENDING AT HL
04CC Cl      POP
          COPYTXTL:
04CD CDC104  CALL  CMHLLTDE
0400 7E      MOV   A,M
0401 02      STAX  B
0402 C8      RZ
04D3 OB      DCX
0404 2B      DCX
04D5 C3CD04  JMP   COPYTXTL


          ; CHECK SPACE FOR STACK ALLOCATION

          SPACESTK:
0408 E5      PUSH  H     ;VERIFY STACK HAS ROOM ENOUGH
0409 2A8703  LHLD  FREELIMT    ;C=NUMBER OF WORDS NEEDED
04DC 0600    MVI   B4O00H
04DE 09      DAD
04DF 09      DAD
04E0 CD0000  CALL  SPACECHK
04E3 El      POP
04E4 C9      RET


          ; CHECK SPACE FOR PROGRAM OR VARIABLE ALLOCATION

          SPACECHK:
04E5 D5      PUSH  D     ;CHECK THAT ENOUGH SPACE IS LEFT
04E6 EB      XCHG        ;ON STACK ABOVE HL
04E7 21DAFF  LXI   H,-38
04EA 39      DAD   SP
04EB CDC104  CALL  CMHLLTDE
04EE EB      XCHG
04EF D1      POP
04F0 DO      RNC
          ERRAOM:
04F1 1E47    MVI   E,ERRNOM-ERRN
04F3 C30000  JMP   ERRMSG

basIC.LST             5-Sep-78 14:14:39                        Page 25





         ; RE-INITIALIZATION ROUTINES

         NEWSTM:
04F6 CO     RNZ        ;NEW COMMAND
         CLEARPGM:
04F7 2A8103 LHLD PROGBASE    ;CLEAR PROGRAM
04FA AF     XRA  A
04FB 77     MOV  M,A
04FC 23     INX
04FD 77     MOV  M,A
04FE 23     INX
         NEWLOAD:
04FF 228303 SHLD VARIABLE
         CLEARSET:
0502 CD0000 CALL CLEARPCN    ;CLEAR PROGRAM POINTERS
         ClEARVST:
0505 227703 SHLD PROGCNTR    ;UPDATE PROGRAM COUNTER
0508 CD0000 CALL CLEARVAR    ;CLEAR VARIABLES
         CLEARSTK:
050B Cl     POP  B     ;RESET STACK,
050C 2A8903 LHLD STCKBASE
050F F9     SPHL
0510 2160FF LXI  H,0-LINESYZE-3
0513 39     DAD  SP
0514 F9     SPHL       ;CREATE INPUT BUFFER
0515 227F03 SHLD INPTBUFR
0518 2A8D03 LHLD STRGBASE    ;CLEAR STRING TEMPORARIES,
051B 23     INX
051C 228F03 SHLD STRGTMPP
051F 210000 LXI  H,0
0522 E5     PUSH H
0523 227903 SHLD PROGCNTS    ;SET NO CONTINUE.
0526 2A7703 LHLD PROGCNTR
0529 C5     PUSH B
052A C9     RET

         CLEARVAR:
052B 2A8303 LHLD VARIABLE    ;CLEAR ALL VARIABLES
052E 228503 SHLD MATTABLE
0531 228703 SHLD FREELIMT
0534 2A8D03 LHLD STRGBASE
0537 228803 SHLD STRGFREE
053A C9     RET

         CLEARPCN:
053B 210000 LXI  H,0   ;CLEAR PROGRAM POINTERS
053E 227903 SHLD PROGCNTS
0541 2A8103 LHLD PROGBASE
0544 2B     DCX
0545 3600   MVI  M,0   ;END OF LINE -1
0547 227703 SHLD PROGCNTR
054A AF     XRA  A

basIC.LST             5-Sep-78 14:14:39                          Page 26





         ; RESTORE: REWIND DATA STATEMENTS

         RESSTM:
0548 CA0000 JZ    RESSTMDF    ;RESTORE STATEMENT
054E CDOB04 CALL  SCANLINN
0551 E5     PUSH  H
0552 CD3004 CALL  LINESRCH
0555 D20000 JNC   ERRAUS
0558 El     POP
0559 EB     XCHG
055A C30000 JMP   RESSTMBU
         RESSTMDF:
055D EB     XCHG        ;DEFAULT IS RESTORE TO BEGINNING
055E 2A8103 LHLD  PROGBASE
         RESSTMBU:
0661 2R     DCX         ;RACK UP RFFORF !INF
         RESDTPTR:
0562 227D03 SHLD  CURDATAP    ;SET DATA POINTER
0565 EB     XCHG
0566 C9     RET



         ; CLEAR: CLEAR VARIABLES, REALLOCATE STRING SPACE

         CLRSTM:
0567 CA0505 JZ    CLEARVST    ;CLEAR STATEMENT
056A CD0000 CALL  VALINTDE
056D 2B     DCX   H     ;bscan
056E CDABO3 CALL  SCANNXT ;bscan
0571 CO     RNZ
0572 E5     PUSH  H
0573 2A8D03 LHLD  STRGBASE
0576 7D     MOV   A,L
0577 93     SUB
0578 5F     MOV   E,A
0579 7C     MOV   A,H
057A 9A     SBB
057B 57     MOV   D,A
057C DA0000 JC    ERRASN
057F 2A8303 LHLD  VARTABLE
0582 012800 LXI   B,40
0585 09     DAD
0586 CDC104 CALL  CMHLLTDE
0589 D2F104 JNC   ERRAOM
058C EB     XCHG
058D 228903 SHLD  STCKBASE
0590 El     POP
0591 C30505 JMP   CLEARVST

basIC.LST             5-Sep-78 14:14:39                          Page 27




         ; LOW-LEVEL CHARACTER I/O ROUTINES

         PRNTCHRI:
0594 E3     XTHL
0595 7E     MOV   A,M
0596 23     INX
0597 E3     XTHL
         PRNTCHRA:
0598 15     PUSH  PSW   ;TRANSMIT CHARACTER
0599 3A6503 LDA   PRINTFLG
059C B7     ORA   A
059D C20000 JNZ   POPAFRET
05A0 Fl     POP   PSW
05A1 F5     PUSH  PSW
05A2 FE20   CPI
05A4 DA0000 JC    PRNTCHRW
05A7 E5     PUSH  H
05A8 2A9903 LHLD  CURSPOS ;LINE TOO LONG?
05AB 7C     MOV   A,H
05AC 85     ADD
05AD 7D     MOV   A,L
05AE El     POP
05AF DC0000 CC    PRNTCRLF
05B2 3C     INR   A
05B3 329903 STA   CURSPOS
         PRNTCHRW:
0586 Fl     POP   PSW   ;SEND CHARACTER
0587 CD2A00 CALL  SYSDISPL
05BA C9     RET


         INPTCHAR:
05BB CD0600 CALL  SYSKEYIN    ;RECEIVE A CHARACTER 
05BE CAB805 JZ    INPTCHAR    ;WAIT FOR ONE
05C1 FEOF   CPI   SI
05C3 CO     RNZ
05C4 3A6503 LDA   PRINTFLG
05C7 2F     CMA
05C8 326503 STA   PRINTFLG
05CB C3BB05 JMP   INPTCHAR

basIC.LST              5-Sep-78 14:14:39                          Page 28






         ; ERROR PROCESSING


         MSGERROR:
05CE 204552 DB    " ERROR",0
0501 524F52
0504 00
         MSGIN: 
0505 20494E DB    " IN ",0
05D8 2000
         MSGOK: 
05DA OD0A4F DB    CR,LF,"OK",CR,LF,0
0500 4B0DOA
05E0 00
         MSGBREAK:
05E1 000A42 DB    CR,LF,"BREAK",0
05E4 524541
05E7 4B00


         ERRDATA:
05E9 2A7B03 LHLD  CURLDATA 
05EC 227303 SHLD  CURLINE
         ERRASN:
05EF 1EA9   MVI   E,ERRNSN-ERRN
         ERRMSG:
05F1 CDOB05 CALL  CLEARSTK 
05F4 AF     XRA   A
05F5 326503 STA   PRINTFLG    ;TURN ON PRINTING 
05F8 326703 STA   SCANPFLG    ;ALLOW SUBSCRIPTING
05FB CD0000 CALL  PRNTCRLF 
05FE 217302 LXI   H,ERRN
0601 57     MOV   D,A
0602 CD9405 CALL  PRNTCHRI    ;print (val)
0605 3F     DB    “?”
0606 19     DAD         ;PRINT ERROR CODE
0607 CD0000 CALL  PRNTMSG
060A 210E05 LXI   H,MSGERROR
         ERRMSGPR:
060D CD0000 CALL  PRNTMSG 
0610 2A7303 LHLD  CURLINE 
0613 7C     MOV   A,H
0614 A5     ANA   L
0615 3C     INR   A 
0616 C40000 CNZ   ERRMSGIN

basIC.LST               5-Sep-78 14:14:39                             Page 29





         ; COMMAND/LINE INPUT

         CMNDSTRT:
0619 AF     XRA    A     ;TOP LEVEL EXECUTIVE
061A 326503 STA    PRINTFLG     ;TURN ON PRINTING
061D 326703 STA    SCANPFLG     ;ALLOW SUBSCRIPTING
0620 21FFFF LXI    H,-1
0623 227303 SHLD   CURLINE 
0626 21DA05 LXI    H,MSGOK 
0629 CD0000 CALL   PRNTMSG ;REQUEST COMMAND
         CMNDINPT:
062C 110000 LXI    D,MSGSTARS+2 ;INPUT COMMAND
062F CD0000 CALL   INPTRQST
0632 DA2C06 JC     CMNDINPT
0635 CDABO3 CALL   SCANNXT      ;bscan ,
0638 F5     PUSH   PSW
0639 CDOB04 CALL   SCANLINN     ;SCAN OFF LINE NUMBER
063C D5     PUSH   D
063D CD0000 CALL   KEYSCAN ;SCAN STATEMENT
0640 D1     POP    D
0641 Fl     POP    PSW
0642 D20000 JNC    EXECUTE ;DIRECT IF NO LINE NUMBER 
0645 CD5904 CALL   LINEINS ;INSERT LINE AS REQUESTED 
0648 C32C06 JMP    CMNDINPT

         CMNDRSTR:
064B CDOB05 CALL   CLEARSTK     ;ENTRY FOR RESTARTING 
064E C00000 CALL   PRNTCRLF 
0651 210000 LXI    H,MSGRED0+11 ;TELL HIM WE"RE STARTING
0654 C30D06 JMP    ERRMSGPR

basIC.LST                      5-Sep-78 14:14:39                                           Page 30





            ; AUTOMATIC LINE-NUMBERED INPUT

            AUTSTMIN:
0657 D5          PUSH    D       ;SAVE LINE NUMBER
0658 CD5904      CALL    LINEINS ;INSERT LINE
0658 El          POP     H       ;RECOVER LINE NUMBER,
065C D1          POP     D       ;INCREMENT
065D 19          DAD
065E DA0000      JC      ERRAOV
0661 C30000      JMP     AUTSTMN

            AUTSTM:
0664 Cl          POP     B       ;REMOVE CALLER
            AUTSTMS:
0665 11E803      LXI     D,1000  ;DEFAULT STARTING LINE NUMBER
0668 016400      LXI     8,100   ;DEFAULT INCREMENT VALUE
066B CDE703      CALL    SCANLPRM         ;SCAN PARAMETERS
066E C2EF05      JNZ     ERRASN
0671 El          POP
0672 CD0000      CALL    PRNTCRLF
            AUTSTMN:
0675 D5          PUSH    D       ;SAVE INCREMENT
0676 E5          PUSH    H       ;AND NEXT LINE NUMBER
0677 CD0000      CALL    ENCODEHL         ;PROMPT WITH LINE NUMBER
067A EB          XCHG
067B 13          INX
067C CD0000      CALL    INPTRQST
067F D1          POP
0680 DA0000      JC      AUTSTMBR
0683 CDABO3      CALL    SCANNXT ;bscan
0686 D25706      JNC     AUTSTMIN
0689 3F          CMC
            AUTSTMBR:
068A D1          POP     D       ;TAKE A BREAK
068B DA1906      JC      CMNDSTRT         ;END OF AUTO
068E C36506      JMP     AUTSTMS ;GET NEW LINE NUMBER,  INCREMENT

basIC.LST               5-Sep-78 14:14:39                            Page 31








          ; LEXICAL SCANNER / KEYWORD RECOGNITION


          KEYSCAN:
0691 0E05    MVI   C,5   ;SCAN INPUT LINE FOR KEYWORDS,
0693 54      MOV   D,H   ;CONDENSE LINE ON TOP OF SELF
0694 5D      MOV   E,L
0695 2B      DCX   H     ;bscan
0696 E5      PUSH  H
0697 CDABO3  CALL  SCANNXT ;bscan +
          KEYSCANL:
069A 7E      MOV   A,M
0698 FE20    CPI   II II
069D CA0000  JZ    KEYSCANH     ;DELETE BLANKS
06A0 47      MOV   B,A
06A1 FE22    CPI   , “
0643 CA0000  J7    KEYSCANI     ;SWAIIN WHnIF STRING
06A6 B7      ORA   A
06A7 CA0000  JZ    KEYSCANX
06AA FE30    CPI   "0"   ;NON-KEYWORD
06AC DA0000  JC    KEYSCANK
06AF FE3C    CPI   'xi,  ;  SO WE DON"T SCAN
06B1 DA0000  JC    KEYSCANP
          KEYSCANK:
06B4 C5      PUSH  B     ;SCAN FOR MATCHING KEYWORD
0685 05      PUSH  D
0666 E5      PUSH  H
06B7 E6OF    ANI   OOFH  ;HASH CHARACTER
06B9 5F      MOV   E,A
06BA 1600    MVI   0,0
06BC 21E400  LXI   H,KEYWADDS   ;ADDRESS C"SPONDING KEYWORDS
06BF 19      DAD   D
06C0 19      DAD   D
06C1 5E      MOV   E,M
06C2 23      INX   H
06C3 56      MOV   D,M
06C4 EB      XCHG
06C5 C30000  JMP   KEYSCANB


          KEYSCANZ:
06C8 1A      LDAX  D
06C9 B7      ORA   A
06CA F20000  JP    KEYSCANN
          KEYSCANM:
06CD 78      MOV   A,B   ;MATCH, GET SYMBOL NUMBER
06CE F680    ORI   080H
06D0 C30000  JMP   KEYSCANF
          KEYSCANN:
0603 23      INX   H     ;ADDRESS NEXT CHAR IN LINE
0604 13      INX   0
0605 OC      INR
          KEYSCANC:
06D6 1A      LDAX  D     ;COMPARE LINE WITH KEYWORD
06D7 E67F    ANI   07FH
0609 CDCE03  CALL  CHARMTCH     ;COMPARE CHARACTERS

basIC.LST                        5-Sep-78 14:14:39                                              Page 32



06DC CAC806      JZ       KEYSCANZ
06DF 79          MOV      A,C      ;MATCH ENOUGH YET?
06E0 FE03        CPI      3
06E2 DA0000      JC       KEYSCANA

06E5 CDBB03      CALL     ALPHACHK         ;STOP ON BREAK CHAR OK
06E8 2B          DCX
06E9 D2CD06      JNC      KEYSCANM
             KEYSCANA:
06EC EB          XCHG
             KEYSCANW:
06ED 86          ORA      M        ;SKIP OVER REST OF KEYWORD
06EE 23          INX
06EF F2ED06      JP       KEYSCANW
06F2 A8          XRA
             KEYSCANB:
06F3 46          MOV      B,M      ;GET CODE FOR KEYWORD
06F4 93          INX
06F5 EB          XCHG
06F6 El          POP      H        ;RESTORE STARTING POSITION
06F7 E5          PUSH     H
06F8 0E00        MVI      C,0
06FA F2D606      JP       KEYSCANC
06FD 7E          MOV      A,M      ;NO MATCH, GET CHARACTER
             KEYSCANF:
06FE D1          POP      D        ;RECOVER OUTPUT POINTER
06FF D1          POP
0700 Cl          POP
0701 063A        MVI      B,":"    ;CHECK FOR SPECIAL PROCESSING
0703 FE8C        CPI      KEYELS
0705 C20000      JNZ      KEYSCAND
0708 EB          XCHG
0709 70          MOV      M,B      ;INSERT COLON BEFORE ELSE
070A EB          XCHG
070B 13          INX
070C OC          INR
             KEYSCAND:
070D FE80        CPI      KEYDAT
070F CA0000      JZ       KEYSCANI
0712 0600        MVI      B4O
0714 FE81        CPI      KEYREM
0716 CA0000      jz       keyscani
0719 FE9C        cpi      keycid   ;pass file name  in load and  save
071B CA0000      jz       keyscani
071E FE9D        cpi      kevcsv
             KEYSCANI:
0720 CC0000      CZ       KEYSCANV
0723 B7          ORA      A
0724 CA0000      JZ       KEYSCANX
             KEYSCANP:
0727 12          STAX     D        ;INSERT SYMBOL IN MEMORY
0728 13          INX
0729 OC          INR
             KEYSCANH:
072A 23          INX
072B C39A06      JMP      KEYSCANL

basIC.LST               5-Sep-78 14:14:39                           Page 33






         KEYSCANX:
072E El      POP   H     ;EXIT KEYWORD TRANSLATION
072F 12      STAX  D     ;END OF STATEMENT
0730 13      INX   D
0731 12      STAX  D     ;END OF "PROGRAM"
0732 13      INX   D
0733 12      STAX  D
0734 47      MOV   B,A   ;LENGTH IN BC
0735 C9      RET



         ; COPY BUFFER TEXT WITHOUT PROCESSING


         KEYSCANV:
0736 12      STAX  D     ;COPY TEXT VERBATIM TO STOPPER
0737 OC      INR
0738 13      INX
0739 23      INX
073A 7E      MOV   A,M
073B B7      ORA   A
073C C8      RZ
073D B8      CMP
073E C8      RZ
073F FE22    CPI   ,fl   ;STRING WITHIN TEXT?
0741 C23607  JNZ   KEYSCANV
0744 C5      PUSH  B
0745 47      MOV   B,A
0746 CD3607  CALL  KEYSCANV
0749 Fl      POP   PSW
074A 47      MOV   B,A
074B 7E      MOV   A,M
074C B7      ORA   A     ;STRING TERMINATE ON END OF LINE?
074D C8      RZ
074E C33607  JMP   KEYSCANV

basIC.LST               5-Sep-78 14:14:39                            Page 34








          ; LINE INPUT ROUTINE


          INPTLNBS:
0751 2B      DCX   H     ;DELETE A CHARACTER FROM INPUT
0752 05      DCR   B
0753 CA0000  JZ    INPTLNRD
0756 CD9405  CALL  PRNTCHRI     ;print (val)
0759 6C      DB    ,\
075A OC      inr   c            ;char count
0758 C30000  JMP   INPTLINL
          INPTLNRD:
075E 210000  LXI   H,MSGSTARS   ;BREAK ENTERED
0761 CD0000  CALL  PRNTMSG ;TELL HIM WE GOT IT
0764 05      DCR   B     ;BREAK AT BEGINNING MEANS BREAK
0765 CA0000  JZ    INPTEXIT


          INPTCRLF:
0768 CD0000  CALL  PRNTCRLF     ;ON THE NEXT LINE
          INPTRQST:
076B 62      MOV   H,D
076C 6B      MOV   L,E   ;PRINT USER"S PROMPT MESSAGE
076D CD0000  CALL  PRNTMSG
0770 2A7F03  LHLD  INPTBUFR     ;INPUT A LINE FROM RECEIVER
0773 010001  LXI   B,1*256
0776 CD9405  CALL  PRNTCHRI     ;print (val)
0779 20      DB    If II        ;OK, WE"RE READY FOR INPUT
          INPTLINL:
077A 3600    MVI   M,0   ;MAINTAIN ENDING ZERO
077C CDB805  CALL  INPTCHAR
          INPTLINC:
077F FE07    CPI   BEL
0781 CA0000  JZ    INPTLNST     ;BELL"S OK
0784 FEOD    CPI   CR
0786 CA0000  JZ    INPTCRTN     ;CARRIAGE RTN IS END OF LINE
0789 FE08    CPI   BS
078B CA5107  JZ    INPTLNBS     ;BACKSPACE IS DELETE
078E FE03    CPI   ETX   ;CONTROL C IS ABORT
0790 CA5E07  JZ    INPTLNRD     ;FORGET THIS LINE, START OVER
0793 FEOC    CPI   FF    ;FORM FEEDS ARE ECHOED
0795 CA0000  JZ    INPTLNEC
0798 FE20    CPI   II It
079A DA7A07  JC    INPTLINL     ;IGNORE OTHER CONTROL CHARS

basIC.LST                5-Sep-78 14:14:39                               Page 35







          INPTLNST:
079D 77      MOV    M,A    ;STORE THE CHARACTER
079E 78      MOV    A,B 
079F FE9D    CPI    LINESYZE 
07A1 3E07    MVI    A,BEL 
07A3 D20000  JNC    INPTLNEC
07A6 04      INR    B
07A7 B1      ORA    C 
07A8 4E      MOV    C,M
07A9 23      INX    H
07AA 3E0A    MVI    A,LF 
07AC FC9805  CM     PRNTCHRA 
07AF 79      MOV    A,C
          INPTLNEC:
07B0 CD9805  CALL   PRNTCHRA     ;ac -> screen ;ECHO CHARACTER
07B3 C37A07  JMP    INPTLINL


          INPTCRTN:
07B6 05      DCR    B      ;CARRIAGE RETURN AT BEGINNING
07B7 CA6807  JZ     INPTCRLF     ;GETS ANOTHER TURN
          INPTEXIT:
07BA 2A7F03  LHLD   INPTBUFR 
07BD 2B      DCX    H
07BE CD0000  CALL   PRNTCRLF
07C1 90      SUB    B      ;SET CONDITION CODES
07C2 3F      CMC                 ;S=C=NZ = BREAK
07C3 9F      SBB    A      ;NS=NC=Z = NON-EMPTY LINE
07C4 C9      RET


          MSGSTARS:
07C5 2A2A2A  DB     .4,4.0110
07C8 00

basIC.LST                5-Sep-78 14:14:39                              Page 36





          ; SET OPTIONS COMMAND

          SETSTM:
07C9 CAEF05  JZ     ERRASN ;TURN OPTION ON OR OFF
07CC FE99    CPI    KEYLIS 
07CE CA0000  JZ     SETSTMLS
0701 F5      PUSH   PSW   ;SAVE OPTION
0702 CDAB03  CALL   SCANNXT ;bscan
0705 CAEF05  JZ     ERRASN 
0708 D691    SUI    KEYON
07DA 47      MOV    B,A   ;SAVE FLAG
07DB CDABO3  CALL   SCANNXT ;bscan +
07DE Fl      POP    PSW   ;WHICH OPTION
07DF FE89    CPI    KEYGTO
07E1 CA0000  JZ     SETSTMGT     ;GOTO
07E4 FP96    CPI    KFYPRT 
07E6 C2EF05  JNZ    ERRASN
          SETSTMPR:
07E9 78      MOV    A,B
07EA 326303  sta    p3010        ;used to be printflg **
07ED C9      RET
          SETSTMGT:
07EE 78      MOV    A,B 
07EF 326603  STA    TRACEFLG
07F2 C9      RET
          SETSTMLS:
07F3 23      INX    H 
07F4 CD0000  CALL   VALBYTE
07F7 2F      CMA                 ;FIND NEGATIVE OF BYTE
07F8 3C      INR    A 
07F9 329A03  STA    CURSLIM
07FC C9      RET


          ; DELETE COMMAND PROCESSOR

          DELSTM:
07FD 11FFFF  LXI    D,OFFFFH     ;DELETE COMMAND
0800 CDE403  CALL   SCANLPRZ
0803 E3      XTHL         ;SAVE SCAN POINTER
0804 EB      XCHG
0805 CDC104  CALL   CMHLLTDE     ;VERIFY FIRST<=LAST
0808 DAEF05  JC     ERRASN
080B E5      PUSH   H
080C CD3004  CALL   LINESRCH     ;LOOK FOR FIRST LINE
080F D1      POP
0810 C6      PUSH   B
0811 CD3004  CALL   LINESRCH     ;LOOK FOR LAST LINE
0814 Cl      POP
0815 CD9304  CALL   LINEDEL 
0818 El      POP    H
0819 C9      RET

basIC.LST              5-Sep-78 14:14:39                          Page 37





         ; LIST COMMAND PROCESSOR

         LISSTM:
081A 110000 LXI   D,0   ;LIST COMMAND
081D 01FFFF LXI   B4OFFFFH    ;TOTAL DEFAULT IS ENTIRE FILE
0820 CA0000 JZ    LISSTMSC
0823 010000 LXI   B4O   ;ELSE DEFAULT IS ONLY ONE LINE
         LISSTMSC:
0826 CDE703 CALL  SCANLPRM    ;SCAN LINE PARAMETERS
0829 C2EF05 JNZ   ERRASN
082C E3     XTHL
082D EB     XCHG
082E E5     PUSH  H
082F CD3004 CALL  LINESRCH
0832 C5     PUSH  B
         IISSTMIP:
0833 Cl     POP   B     ;MOVE ON TO NEXT LINE
0834 D1     POP
0835 El     POP
0836 CD3E00 CALL  SYSBREAK    ;ALLOW BREAK
0839 CA0000 JZ    EXECUTEB
083C C5     PUSH  B
083D E3     XTHL
083E CD4D04 CALL  LINELINK
0841 CA0000 JZ    POPHLRET    ;END OF PROGRAM, QUIT
0844 D5     PUSH  D
0845 C5     PUSH  B
0846 E5     PUSH  H     ;SAVE TEXT FOR LATER
0847 4E     MOV   C,M   ;FETCH LINE NUMBER
0848 23     INX
0849 46     MOV   B,M
084A 60     MOV   H,B
084B 69     MOV   L,C
084C EB     XCHG
084D CDC104 CALL  CMHLLTDE
0850 DA0000 JC    LISSTMXT    ;LAST LINE REACHED?
0853 CD0000 CALL  PRNTCRLF    ;LIST CURRENT LINE
0856 EB     XCHG
0857 CD0000 CALL  PRINTINT    ;PRINT LINE NUMBER
085A CD9405 CALL  PRNTCHRI    ;print (val)
085D 20     DB    " "   ;FOLLOWED BY BLANK
085E El     POP
085F CD0000 CALL  LISEDIXP    ;EXPAND TEXT
0862 CD0000 CALL  PRNTMSG ;AND PRINT IT
0865 21A000 LXI   H2O+LINESYZE+3
0868 39     DAD   SP
0869 F9     SPHL        ;DEALLOCATE EXPANDED TEXT
086A C33308 JMP   LISSTMLP

basIC.LST                5-Sep-78 14:14:39                              Page 38




          LISSTMXT:
086D El      POP
          POPHL3RT:
086E El      POP
086F El      POP
          POPHLRET:
0870 El      POP
0871 C9      RET




          ; EXPAND KEYWORDS IN LINE / INVERSE OF KEYSCAN

          LISEDIXP:
0872 OE4E    MVI    C,LINESYZE/2 ;SPACE ENOUGH TO EXPAND LINE?
0874 CDD804  CALL   SPACESTK
0877 EB      XCHG         ;SAVE POINTER TO LINE TO EXPAND
0878 Cl      POP    B     ;AND CALLER
0879 2160FF  LXI    H,0-LINESYZE-3
087C 39      DAD    SP
087D F9      SPHL         ;CREATE TEXT BUFFER ON STACK
087E C5      PUSH   B     ;PUT BACK CALLER
087F EB      XCHG
0880 23      INX
0881 23      INX    H     ;plus 2
0882 E5      PUSH   H     ;SAVE TEXT POINTER
0883 210400  LXI    H,4   ;CREATE POINTER TO EXPAND TEXT
0886 39      DAD    SP
0887 EB      XCHG
0888 069D    MVI    B,LINESYZE   ;INITIALIZE LENGTH COUNTER
088A C30000  JMP    LISEDIKD
          LISEDISC:
088D CD0000  CALL   LISEDIST     ;STUFF ONE CHARACTER OF LINE
          LISEDIKD:
0890 El      POP    H     ;DO REST OF LINE
0891 7E      MOV    A,M
          LISEDINC:
0892 23      INX
0893 FE3A    CPI    ":"
0895 C20000  JNZ    LISEDIKT
0898 7E      MOV    A,M
0899 FE8C    CPI    KEYELS ;:ELSE BECOMES ELSE
089B CA9208  JZ     LISEDINC
089E 3E3A    MVI    A,":"
          LISEDIKT:
08A0 A7      ANA    A     ;MOVE HIGH ORDER INTO S-FLAG
08A1 CA0000  JZ     LISEDIXT
08A4 E5      PUSH   H
08A5 F28D08  JP     LISEDISC
08A8 4F      MOV    C,A

basIC.LST                5-Sep-78 14:14:39                              Page 39




08A9 21A0A3  LXI    H,KEYLSBH*256+KEYLSBL
08AC CD0000  CALL   LISEDISB     ;OPTIONAL BLANK BEFORE KEYWORD
08AF 210401  LXI    H,KEYWORDS   ;SEARCH FOR KEYWORD
0882 C30000  JMP    LISEDIKS
          LISEDIKL:
0885 B6      ORA    M
08B6 23      INX    H
08B7 F2B508  JP     LISEDIKL
          LISEDIKS:
08BA 7E      MOV    A,M   ;FETCH KEYWORD NUMBER
08BB F680    ORI    080H
08BD 23      INX    H
08BE A9      XRA    C
08BF C2B508  JNZ    LISEDIKL
          LISEDIKY:
08C2 7E      MOV    A,M   ;EXPAND KEYWORD
08C3 07      RLC
08C4 A7      ANA    A     ;HIGH-ORDER TO CARRY
08C5 1F      RAR
08C6 CD0000  CALL   LISEDIST     ;STUFF THIS CHARACTER
08C9 23      INX    H
08CA D2C208  JNC    LISEDIKY     ;DO THEM ALL
08CD 79      MOV    A,C
O8CE 2182A5  LXI    H,KEYLSAH*256+KEYLSAL
08D1 CD0000  CALL   LISEDISB     ;OPTIONAL BLANK AFTER KEYWORD
08D4 C39008  JMP    LISEDIKD

          LISEDISB:
08D7 BD      CMP    L     ;INSERT BLANK IN LINE IF
08D8 D8      RC           ;L <= A < H
08D9 BC      CMP    H
08DA DO      RNC
08DB 3E20    MVI          ;GENERATE BLANK
          LISEDIST:
08DD 12      STAX   D
08DE 13      INX    D
08DF 05      DCR    B
08E0 CO      RNZ          ;TRUNCATE TOO LONG A LINE
08E1 04      INR    B
08E2 2B      DCX    H
08E3 C9      RET

          LISEDIXT:
08E4 12      STAX   D
08E5 3E9E    MVI    A,LINESYZE+1 ;COMPUTE LENGTH OF OUTPUT
08E7 90      SUB    B
08E8 47      MOV    B,A
08E9 210200  LXI    H,2   ;CREATE POINTER TO EXPAND TEXT
08EC 39      DAD    SP
08ED C9      RET          ;AND RETURN

basIC.LST                           5-Sep-78 14:14:39                                                  Page 40








              ;  EDIT COMMAND PROCESSOR


              EDISTM:
HEE 110000         LXI      D,0       ;SCAN PARAMETERS
0811 CDE403        CALL     SCANLPRZ
08F4 E3            XTHL               ;SAVE SCAN,
08F5 226F03        SHLD     SCANPTR1           ;AND OUTPUT LINE NUMBER
08F8 CD3004        CALL     LINESRCH           ;LOOK UP LINE
08FB D20000        JNC      ERRAUS    ;NOT FOUND...
08FE 60            MOV      H,B
08FF 69            MOV      L,C
0900 23            INX
0901  23           INX      H         ;plus 2
0902 CD7208        CALL     LISEDIXP           ;EXPAND LINE
0905 2A6F03        LHLD     SCANPTR1           ;RECOVER LINE NUMBER
0908 E5            PUSH     H
              EDISTMLS:
0909 CD0000        CALL     EDISTMCR           ;GIVE HIM A LOOK AT IT
090C CD0000        CALL     PRNTMSG   ;PRINT COPY OF TEXT
090F CD0000        CALL     EDISTMCR           ;A NEW EDIT LINE
0912 0E01          MVI      C,1       ;POSITION COUNTER
              EDISTMNX:
0914 CD0000        CALL     EDISTMCH           ;OK MASTER,   TELL ME WHAT TO DO
0917  FE20         CPI      11 II     ;MOVE ALONG
0919 CA0000        JZ       EDISTMAD
091C CDBCO3        CALL     ALPHACHA           ;CONVERT LOWER TO UPPER
091F  FE44         CPI      "D"       ;DELETE
0921 CA0000        JZ       EDISTMDL
0924 FE49          CPI      "I"       ;INSERT
0926 CA0000        JZ       EDISTMIN
0929 FE52          CPI      "R"       ;REPLACE
092B CA0000        JZ       EDISTMRP
              EDISTMER:
092E 3E07          MVI      A,BEL     ;SQUAWK ABOUT ERROR
              EDISTMEC:
0930 CD9805        CALL     PRNTCHRA           ;ac ->  screen
0933 C31409        JMP      EDISTMNX


              ;  ADVANCE
              •
              EDISTMAD:
0936 79            MOV      A,C
0937 B8            CMP      B         ;CAN WE STILL ADVANCE?
0938 D22E09        JNC      EDISTMER
093B OC            INR      C         ;ADVANCE POSITION COUNTER
093C 7E            MOV      A,M
093D 23            INX      H         ;PRINT CHARACTER PASSED OVER
093E C33009        JMP      EDISTMEC

basIC.LST                     5-Sep-78 14:14:39                                        Page 41




            ; DELETE

            EDISTMDL:
0941 79         MOV     A,C
0942 88         CMP     B       ;ANYTHING TO DELETE?
0943 D22E09     JNC     EDISTMER
0946 05         DCR     B       ;DECREASE CHARACTER COUNT
0947 E5         PUSH    H       ;SAVE CURRENT POSITION
0948 7E         MOV     A,M
0949 CD9805     CALL    PRNTCHRA        ;LIST CHARACTER DELETED
094C 54         MOV     D,H
094D 5D         MOV     E,L
            EDISTMDM:
094E 23         INX
094F 7E         MOV     A,M     ;MOVE THIS CHARACTER DOWNWARD
0950 12         STAX    D
0951 13         INX
0952 B7         ORA     A
0953 C24E09     JNZ     EDISTMDM
0956 El         POP
0957 C31409     JMP     EDISTMNX

            ; INSERT

            EDISTMIN:
095A CD0000     CALL    EDISTMCH        ;GET SOMETHING TO PUT IN
095D 57         MOV     D,A     ;SAVE COPY OF CHARACTER
            EDISTMRI:
095E 78         MOV     A,B
095F FE9D       CPI     LINESYZE        ;ROOM AT THE INNPUT BUFFER?
0961 D22E09     JNC     EDISTMER
0964 04         INR     B       ;COUNT NEWCOMER
0965 OC         INR     C       ;NEXT ONE GOES AFTER HIM
0966 7A         MOV     A,D
0967 CD9805     CALL    PRNTCHRA        ;ac -> screen  ;PRINT NEWCOMER
096A E5         PUSH    H       ;SAVE CURRENT POSITION
            EDISTMIM:
096B 5E         MOV     E,M
096C 77         MOV     M,A     ;MOVE CHARACTERS UP ONE BYTE
096D B7         ORA     A
096E 7B         MOV     A,E
096F 23         INX
0970 C26B09     JNZ     EDISTMIM
0973 El         POP
0974 23         INX
0975 C35A09     JMP     EDISTMIN

basIC.LST                        5-Sep-78 14:14:39                                              Page 42




             ;  REPLACE

             EDISTMRP:
0978 CD0000      CALL     EDISTMCN         ;GET UPDATE CHARACTER
0978 57          MOV      D,A
097C 79          MOV      A,C
097D B8          CMP      B        ;REPLACING END OF LINE?
097E D25E09      JNC      EDISTMRI         ;IF SO,  GO TO INSERT
0981 72          MOV      M,D      ;UPDATE THE CHARACTER
0982 OC          INR 
0983 23          INX 
0984 7A          MOV      A,D 
0985 CD9805      CALL     PRNTCHRA         ;ac -> screen     ;PRINT NEWCOMER
0988 C37809      JMP      EDISTMRP

                SEARCH

             EDISTMSR:
098B CD0000      CALL     EDISTMCH         ;FIND CHARACTER TO SEARCH FOR
098E CDBCO3      CALL     ALPHACHA         ;CONVERT TO STANDARD CASE
0991 57          MOV      D,A
0992 1E00        MVI      E,0
             EDISTMSL:
0994 79          MOV      A,C
0995 B8          CMP      B
0996 D22E09      JNC      EDISTMER         ;NO MORE,  TERMINATE SEARCH
0999 COBB03      CALL     ALPHACHK         ;FETCH CHARACTER IN STANDARD CASE
099C BB          CMP      E
099D CA1409      JZ       EDISTMNX         ;GOTTA MATCH?
09A0 CD9805      CALL     PRNTCHRA         ;ac -> screen     ;LIST FAILURES
09A3 OC          INR      C
09A4 23          INX      H
09A5 5A          MOV      E,D
09A6 C39409      JMP      EDISTMSL         ;AND KEEP LOOKING

basIC.LST             5-Sep-78 14:14:39                          Page 43




         EDISTMXT:
09A9 OD     DCR   C     ;BEGINNING CR MEANS DONE, UPDATE
09AA C20909 JNZ   EDISTMLS    ;OTHERWISE, LIST, MORE EDITS 
O9AD D1     POP         ;RETRIEVE LINE NUMBER
09AE 210000 LXI   H,0
09B1 39     DAD   SP    ;POINT TO TEXT
09B2 CD5904 CALL  LINEINS ;AND REINSERT
         EDISTMQT:
09B5 21A000 LXI   H2O+LINESYZE+3
09B8 39     DAD   SP
09B9 F9     SPHL        ;DEALLOCATE TEXT BUFFER 
09BA El     POP   H     ;RECOVER SCAN POINTER 
0988 C9     RET         ;AND RETURN

         ; LIST LINE, PREPARE FOR UPDATES

         EDISTMCR:
09BC D1     POP
09BD El     POP   H     ;RETRIEVE COPY OF LINE NUMBER
098E E5     PUSH  H     ;SAVE IT,
098F D5     PUSH  D
09C0 C5     PUSH  B     ;AND LINE LENGTH
09C1 CD0000 CALL  PRNTCRLF
09C4 CD0000 CALL  PRINTINT    ;PRINT LINE NUMBER
09C7 CD9405 CALL  PRNTCHRI    ;print (val)
09CA 20     DB
09CB 210600 LXI   H,6
09CE 39     DAD   SP    ;CREATE POINTER TO TEXT BUFFER
09CF Cl     POP 
0900 C9     RET

         ; GET OPTION CHARACTER

         EDISTMCH: 
0901 CDBBO5 CALL  INPTCHAR    ;GET CHARACTER ROUTINE
09D4 FE20   CPI 
0906 DO     RNC         ;NOT CONTROL, RETURN
0907 FE07   CPI   BEL
0909 C8     RZ
09DA D1     POP         ;REMOVE CALLER
0906 FE09   CPI   HT    ;SEARCH (TAB)
09DD CA8809 JZ    EDISTMSR
09E0 FEOD   CPI   CR    ;LIST, OR UPDATE
09E2 CAA909 JZ    EDISTMXT
09E5 FE1B   CPI   ESC   ;TERMINATE OPTION
09E7 CA1409 JZ    EDISTMNX
09EA FE03   CPI   ETX   ;ABORT, NO UPDATE
09EC C22E09 JNZ   EDISTMER
09EF 210507 LXI   H,MSGSTARS  ;TYPE BREAK MESSAGE
09F2 CD0000 CALL  PRNTMSG
09F5 D1     POP 
09F6 C3B509 JMP   EDISTMQT

basIC.LST               5-Sep-78 14:14:39                            Page 44




          ; SCAN STACK FOR "FOR" LOOP

09F9 0010 FORBLCK  EQU   16     ;SIZE OF "FOR" STACK ENTRY

          FORCHK:
09F9 210400  LXI   H,4   ;LOOK FOR MARK ON STACK
09FC 39      DAD   SP
          FORCHKL:
09FD 7E      MOV   A,M
09FE 23      INX
09FF FE83    CPI   KEYFOR
OA01 CO      RNZ
0A02 3E04    MVI   A,TYPESING
0A04 326B03  STA   TYPEFLG ;SET CORRECT TYPE FLAG
0A07 4E      MOV   C,M   ;MARK IS PRESENT
0A08 23      INX
0A09 46      MOV   R,M
0A0A 23      INX
OAOB E5      PUSH  H
OAOC 60      MOV   H,B
OAOD 69      MOV   L,C
OAOE 7A      MOV   A,D   ;LOOKING FOR PARTICULAR VARIABLE?
OAOF B3      ORA
°A1° EB      XCHG
°All CA0000  JZ    FORCHKXT
0A14 EB      XCHG        ;IS THIS IT?
0A15 CDC104  CALL  CMHLLTDE
          FORCHKXT:
0A18 010D00  LXI   B,FORBLCK-3
0A1B El      POP
0A1C C8      RZ
0A1D 09      DAD
0A1E C3FD09  JMP   FORCHKL


          ; FOR STATEMENT PROCESSOR

          FORSTM:
0A21 3EAB    MVI   A,SCANPFLD   ;FOR STATEMENT
0A23 326703  STA   SCANPFLG
0A26 CD0000  CALL  LETSTM
0A29 CDD903  CALL  TYPECHK
OA2C EA0000  JPE   ERRATM ;MUST BE SINGLE INDEX
0A2F E3      XTHL        ;SAVE SCANPTR, REMOVE CALLER
0A30 EB      XCHG
0A31 227703  SHLD  VARINDEX
0A34 EB      XCHG
0A35 CDF909  CALL  FORCHK
0A38 D1      POP
0A39 C20000  JNZ   FORSTMNF
0A3C 09      DAD
0A3D F9      SPHL
          FORSTMNF:
0A3E EB      XCHG
OA3F 0E08    MVI   C,FORBLCK+1/2

basIC.LST              5-Sep-78 14:14:39                          Page 45



0A41 CDD804 CALL  SPACESTK

0A44 E6     PUSH  H
0A45 CD0000 CALL  DATSTM ;FIND FIRST STATEMENT IN FOR LOOP
0A48 E3     XTHL        ;AND SAVE
0A49 E5     PUSH  H
OA4A 2A7303 LHLD  CURLINE ;SAVE CURRENT LINE NUMBER
OA4D E3     XTHL
OA4E CDA303 CALL  SCANNXTV    ;bscan (val)
0A51 Al     DB    KEYTO ;SCAN LIMIT VALUE,
0A52 CD0000 CALL  VALNUMBR    ;bscan numbr
0A55 E5     PUSH  H
0A56 CD0000 CALL  LDRGAC
0A59 El     POP
0A5A C5     PUSH  B     ;SAVE ON STACK
0A5B D5     PUSH  0
0A5C 010081 LXI   8,08100H    ;LOAD DEFAULT STEP■1.0
0A5F 51     MOV   D,C
0A60 5A     MOV   E,D
0A61 7E     MOV   A,M
0A62 FEA2   CPI   KEYSTEP ;CHECK FOR EXPLICIT STEP SIZE
0A64 3E01   MVI   A,001H
0A66 C20000 JNZ   FORSTMST
0A69 CDABO3 CALL  SCANNXT ;bscan +
OA6C CD0000 CALL  VALNUMBR    ;bscan numbr
OA6F E5     PUSH  H
0A70 CD0000 CALL  LDRGAC
0A73 El     POP
0A74 CD0000 CALL  SIGNACC
         FORSTMST:
0A77 C5     PUSH  B     ;SAVE STEP SIZE ON STACK
0A78 D5     PUSH  D
0A79 F5     PUSH  PSW   ;SAVE DIRECTION
OA7A 33     INX   SP
OA7B E5     PUSH  H
OA7C 2A7703 LHLD  VARINDEX    ;SAVE INDEX VARIABLE
OA7F E3     XTHL
         FORMARK:
0A80 0683   MVI   B,KEYFOR    ;MARK STACK WITH "FOR"
0A82 C5     PUSH  B
0A83 33     INX   SP

basIC.LST              5-Sep-78 14:14:39                          Page 46








         ; INTERPRETER EXECUTIVE


         EXECUTEL:
0A84 CD0000 CALL  BREAKCHK    ;USER HAVE ANY COMMENTS?
0A87 227703 SHLD  PROGCNTR
0A8A 7E     MOV   A,M
0A8B FE3A   CPI   “:“
OABD CA0000 JZ    EXECUTE ;MULTIPLE STATEMENTS ON LINE?
0190 B7     ORA   A
0A91 C2EF05 JNZ   ERRASN
0A94 23     INX   H     ;END OF LINE,
0A95 7E     MOV   A,M
0A96 23     INX
0A97 B6     ORA
0198 23     INX
DARR CA0000 JZ    ENDPROGM    ;END OF PROGRAM?
0A9C 5E     MOV   E,M
0A9D 23     INX
0A9E 56     MOV   D,M
0A9F EB     XCHG
OAAO 227303 SHLD  CURLINE ;MOVE TO NEXT LINE
OAA3 EB     XCHG
         EXECUTE:
OAA4 CDABO3 CALL  SCANNXT ;bscan ,  ;EXECUTE STATEMENT
OAA7 11840A LXI   D,EXECUTEL
OAAA D5     PUSH  D
         EXECUTEC:
OAAB C8     RZ
         EXECUTES:
OAAC FE80   CPI   KEYSTM ;WHAT KIND OF STATEMENT?
OAAE DA0000 JC    LETSTM
OAB1 FEAO   CPI   KEYSUGR
0183 D20000 JNC   EXECUTE2
OAB6 87     ADD   A
OAB7 4F     MOV   C,A
OAB8 0600   MVI   B4O00H
OABA EB     XCHG
OABB 214E00 LXI   H,STMTABL
OABE 09     DAD
OABF 4E     MOV   C,M
OACO 23     INX
OAC1 46     MOV   B,M
OAC2 C5     PUSH  B
OAC3 EB     XCHG
OAC4 C3ABO3 JMP   SCANNXT


````



````
basIC.LST               5-Sep-78 14:29:54                              Page 52





0C37 28      DCX
0C38 CDABO3  CALL  SCANNXT ;bscan
OC3B 7B      MOV   A.E
0C3C C9      RET


          EXECUTE2:
0C3D FEC4    CPI   KEYPORT ;PORT OUTPUT?
0C3F CA0000  JZ    PORSTM
0C42 FEC6    CPI   KEYMEM ;MEMORY ALTERATION?
0C44 CA0000  JZ    MEMSTM



          ; MID-STRING ASSIGNMENT STATEMENT


          MIDSTM:
0C47 CDA303  CALL  SCANNXTV     ;bscan (val)
OC4A D1      DB    KEYMID ;ENTER POINTING TO "MID$"
0C48 CDA303  CALL  SCANNXTV     :hscan (val)
OC4E 28      DB    .(.
OC4F CD0000  CALL  VARSCAN ;SCAN VARIABLE TO UPDATE
0052 CDFBOB  CALL  CSTRING ;MAKE SURE ITS A STRING
0055 D5      PUSH  D      ;SAVE REFERENCE
0056 E5      PUSH  H
0057 CD0000  CALL  STRGTEST     ;WHERE IS STRING NOW?
005A D5      PUSH  D      ;SHOULDN"T BE IN PROGRAM
005B D40000  CNC   STRGSTOR     ;OR ELSE WE MODIFY OURSELF
005E El      POP   H
005F CD0000  CALL  COPYVAL
0062 El      POP   H      ;CONTINUE SCAN
0063 CD280C  CALL  VALBYTE2     ;SCAN STARTING POSITION
0066 B7      ORA   A
0067 CA230C  JZ    ERRAFC ;MUST BE NON-ZERO
0C6A D5      PUSH  D
0C6B 1EFF    MVI   E,OFFH
0C6D 7E      MOV   A,M
0C6E FE29    CPI   .),,   ;DEFAULT LENGTH?
0070 C4280C  CNZ   VALBYTE2     ;SCAN LENGTH, IF GIVEN
0073 CDA303  CALL  SCANNXTV     ;bscan (val)
0076 29      DB    1.
0077 Cl      POP   B      ;CONDENSE STACK
0078 51      MOV   D,C
0079 05      PUSH  D
0C7A CDA303  CALL  SCANNXTV     ;bscan (val)
0C7D 85      DB    KEYEQ
OC7E CD0000  CALL  VALEXPR ;bscan expr ;EVALUATE RIGHT HAND SIDE
0081 226F03  SHLD  SCANPTRI
0084 00000   CALL  LENFCTC ;RELEASE STRING RESOURCE
0087 4E      MOV   C,M    ;AND LOAD DESCRIPTOR
0088 23      INX   H
0089 46      MOV   B,M
0C8A D1      POP   D      ;GET BACK LENGTH, START
0C8B BB      CMP   E
0C8C D20000  JNC   MIDSTMLN     ;LENMOV = MIN(LENI, LENS)
OC8F 5F      MOV   E,A
          MIDSTMLN:
0C90 El      POP   H      ;RECOVER DESTINATION DESCRIPTOR
````
--------------------------------------------------------------------------------
Cheers
